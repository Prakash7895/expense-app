import{E as v,j as s,r as f,ae as D,Z as O}from"./index-2e-nGteb.js";import{S as B,l as R,r as p,D as L,t as I}from"./DynamicForm--ABcZsjd.js";import{c as T,a as _,i as G}from"./constants-98K82Bco.js";import{i as P}from"./axiosInstance-Il8iOTPN.js";const y=l=>{var h,i,x,b,n;return v.error(s.jsx("div",{children:((x=(i=(h=l==null?void 0:l.response)==null?void 0:h.data)==null?void 0:i.errors)==null?void 0:x.map(r=>s.jsx("p",{children:r.msg},r.msg)))??((n=(b=l==null?void 0:l.response)==null?void 0:b.data)==null?void 0:n.message)??(l==null?void 0:l.message)??"Error"}))},K=()=>{const[l,h]=f.useState(!1),[i,x]=f.useState(!1),[b,n]=f.useState(!1),[r,m]=f.useState(!1),[w,F]=f.useState("IN"),S=T.map(e=>{const o=_.find(j=>j.code===e);return{value:o==null?void 0:o.countryCode,Flag:G[e],label:o==null?void 0:o.name,field:o==null?void 0:o.code}}).filter(e=>!!e.value).sort((e,o)=>e.label<o.label?-1:1),a=S.find(e=>e.field===w),u=s.jsx(s.Fragment,{children:r&&s.jsx("div",{className:"relative w-full max-w-36 h-full",children:s.jsx(B,{label:"Country Code",variant:"bordered",size:"sm",className:"absolute -top-[6px] -left-3.5",classNames:{popoverContent:"!w-[250px]",value:"w-0",trigger:"border-0 border-r-2"},items:S,onChange:e=>{console.log("change",e.target.value),F(e.target.value)},selectedKeys:w?[w]:[],startContent:w?s.jsxs("div",{className:"w-full flex items-center truncate",children:[a==null?void 0:a.Flag({className:"h-4 shrink-0"}),s.jsx("p",{children:a==null?void 0:a.value})]}):null,children:e=>{const o=e.Flag;return s.jsxs(R,{textValue:e.value,classNames:{title:"flex items-center justify-start gap-3"},children:[s.jsx(o,{className:"h-6 shrink-0"}),s.jsxs("div",{className:"flex-1 flex flex-wrap flex-col text-wrap",children:[s.jsx("p",{className:"text-default-700",children:e.label}),s.jsx("p",{children:e.value})]})]},e.field)}})})}),d=e=>s.jsx("div",{children:s.jsx("p",{className:"text-default cursor-pointer",onClick:()=>{P.post("/api/user/resend-otp",{emailOrPhone:e==null?void 0:e.emailOrPhone,countryCode:a==null?void 0:a.value}).then(o=>{var j;v.success((j=o.data)==null?void 0:j.message)}).catch(o=>{y(o)})},children:"Resend OTP"})}),[N,g]=f.useState([p(r,m,u,d)[0]]);f.useEffect(()=>{!l&&!i&&g([p(r,m,u,d)[0]])},[r]);const E=(e,o,j)=>{console.log("onSubmit",e),n(!0),l?i?P.post("/api/user/reset-password",{emailOrPhone:e==null?void 0:e.emailOrPhone,countryCode:a==null?void 0:a.value,otp:e==null?void 0:e.otp,password:e==null?void 0:e.password}).then(t=>{var c;console.log("RES33333",t),j(),v.success((c=t.data)==null?void 0:c.message),n(!1),x(!1),h(!1),g([p(r,m,u,d)[0]])}).catch(t=>{y(t),n(!1)}):P.post("/api/user/verify-otp",{emailOrPhone:e==null?void 0:e.emailOrPhone,countryCode:a==null?void 0:a.value,otp:e==null?void 0:e.otp}).then(t=>{var c;console.log("RES2222",t),v.success((c=t.data)==null?void 0:c.message),g(p(r,m,u,d).map(C=>({...C,isDisabled:["emailOrPhone","otp"].includes(C.name)}))),x(!0),n(!1)}).catch(t=>{y(t),n(!1)}):P.post("/api/user/get-otp",{emailOrPhone:e==null?void 0:e.emailOrPhone,countryCode:a==null?void 0:a.value}).then(t=>{var c;console.log("RES",t),v.success((c=t.data)==null?void 0:c.message),g(p(r,m,u,d).slice(0,2).map(C=>({...C,isDisabled:C.name==="emailOrPhone"}))),h(!0),n(!1)}).catch(t=>{y(t),n(!1)})},k=()=>{i?(g(p(r,m,u,d).slice(0,2).map(e=>({...e,isDisabled:e.name==="emailOrPhone"}))),x(!1)):l&&(g([p(r,m,u,d)[0]]),h(!1))};return s.jsx("div",{className:"h-screen -mb-6 flex justify-center items-center",children:s.jsx(L,{hideCloseButton:!0,formClassName:"lg:w-1/4 md:w-1/3 sm:w-1/2 w-full m-10",fields:N,onSubmit:E,validationSchema:I(l,i),submitButtonProps:{isLoading:b,isDisabled:b},formHeader:s.jsxs("div",{className:"justify-center pl-4",children:[l&&s.jsx(D,{className:"absolute left-4 cursor-pointer",onClick:k}),"Forgot Password"]}),submitButtonLabel:l?i?"Reset Password":"Verify OTP":"Get OTP",otherFooterElements:s.jsx(s.Fragment,{children:s.jsxs("p",{children:["Go to"," ",s.jsx(O,{to:"/login",className:"text-primary-500",children:"Login"})," ","page"]})}),buttonWrapperClassName:"justify-center items-center flex-col gap-3"})})};export{K as default};
